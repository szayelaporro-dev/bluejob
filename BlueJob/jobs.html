<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlueJob - All Jobs</title>
  <link rel="stylesheet" href="jobs.css" />
</head>
<body>
  <header>
    <div class="logo">BlueJob</div>

    <div class="search-bar">
      <input type="text" id="search" placeholder="Search jobs, companies, or skills..." />
    </div>

    <nav>
      <a href="#">Find Jobs</a>
      <a href="company.html">Companies</a>
      <a href="resources.html">Resources</a>
      <a href="#" id="logoutBtn">LogOut</a>
      <a class="post-job" id="openPostForm">Post a Job</a>
    </nav>
  </header>

  <div class="popup" id="postJobPopup">
    <div class="popup-content">
      <h3>Post a Job</h3>
      <input type="text" id="jobTitle" placeholder="Job Title" required />
      <input type="text" id="companyName" placeholder="Company Name" required />
      <input type="text" id="location" placeholder="Location" required />
      <select id="category">
        <option value="electrical">Electrical</option>
        <option value="construction">Construction</option>
        <option value="hvac">HVAC</option>
        <option value="plumbing">Plumbing</option>
      </select>
      <select id="jobType">
        <option value="full-time">Full-time</option>
        <option value="part-time">Part-time</option>
      </select>
      <input type="text" id="salary" placeholder="Salary (e.g. â‚±200/hour)" required />
      <button id="submitJob">Post</button>
      <button class="close-popup" id="closePopup">Cancel</button>
    </div>
  </div>

  <div class="container">
    <aside>
      <h3>Filter Jobs</h3>
      <h4>Trade Categories</h4>
      <label><input type="checkbox" value="electrical" class="filter" /> Electrical</label>
      <label><input type="checkbox" value="construction" class="filter" /> Construction</label>
      <label><input type="checkbox" value="hvac" class="filter" /> HVAC</label>
      <label><input type="checkbox" value="plumbing" class="filter" /> Plumbing</label>

      <h4>Job Type</h4>
      <label><input type="checkbox" value="full-time" class="filter" /> Full-time</label>
      <label><input type="checkbox" value="part-time" class="filter" /> Part-time</label>

      <h4>Salary Range</h4>
      <label><input type="checkbox" value="low" class="filter-salary" /> â‚±60-80/hour</label>
      <label><input type="checkbox" value="mid" class="filter-salary" /> â‚±80-120/hour</label>
      <label><input type="checkbox" value="high" class="filter-salary" /> â‚±120+/hour</label>
    </aside>

    <main>
      <h2>All Jobs</h2>

      <div id="jobList">
        <div class="job-card" data-category="electrical" data-type="full-time" data-salary="low">
          <div class="job-header">
            <h3>Experienced Electrician</h3>
            <span class="tag electrical">Electrical</span>
          </div>
          <div class="company">PowerTech Solutions</div>
          <div class="details">ğŸ“ Makati City Â· â‚±180â€“220/hour Â· Full-time</div>
          <a href="electrician.html" class="view-btn">View Details</a>
        </div>

        <div class="job-card" data-category="construction" data-type="part-time" data-salary="mid">
          <div class="job-header">
            <h3>Construction Worker</h3>
            <span class="tag construction">Construction</span>
          </div>
          <div class="company">BuildRight Corp.</div>
          <div class="details">ğŸ“ Quezon City Â· â‚±90â€“120/hour Â· Part-time</div>
          <a href="construction.html" class="view-btn">View Details</a>
        </div>

        <div class="job-card" data-category="hvac" data-type="full-time" data-salary="high">
          <div class="job-header">
            <h3>HVAC Technician</h3>
            <span class="tag hvac">HVAC</span>
          </div>
          <div class="company">CoolAir Systems</div>
          <div class="details">ğŸ“ Pasig City Â· â‚±150â€“180/hour Â· Full-time</div>
          <a href="HVAC.html" class="view-btn">View Details</a>
        </div>

        <div class="job-card" data-category="plumbing" data-type="full-time" data-salary="mid">
          <div class="job-header">
            <h3>Plumber Needed</h3>
            <span class="tag plumbing" style="background:#4caf50;">Plumbing</span>
          </div>
          <div class="company">FlowFix Services</div>
          <div class="details">ğŸ“ Mandaluyong City Â· â‚±100â€“120/hour Â· Full-time</div>
          <a href="plumber.html" class="view-btn">View Details</a>
        </div>

        <div class="job-card" data-category="construction" data-type="full-time" data-salary="high">
          <div class="job-header">
            <h3>Site Supervisor</h3>
            <span class="tag construction">Construction</span>
          </div>
          <div class="company">MetroBuild Development</div>
          <div class="details">ğŸ“ Taguig City Â· â‚±130â€“160/hour Â· Full-time</div>
          <a href="supervisor.html" class="view-btn">View Details</a>
        </div>

        <div class="job-card" data-category="electrical" data-type="full-time" data-salary="high">
          <div class="job-header">
            <h3>Urgent Hiring: Master Electrician</h3>
            <span class="tag urgent">Urgent</span>
          </div>
          <div class="company">LightWorks Engineering</div>
          <div class="details">ğŸ“ Manila Â· â‚±200+/hour Â· Full-time</div>
          <a href="urgent.html" class="view-btn">View Details</a>
        </div>
      </div>
    </main>
  </div>

  <script src="https://unpkg.com/pocketbase@latest/dist/pocketbase.umd.js"></script>

  <script>
    const pb = new PocketBase("http://127.0.0.1:8090");

    // Redirect to login if not authenticated
    window.addEventListener('load', () => {
      if (!pb.authStore.isValid) {
        window.location.href = 'test.html';
      }
    });

    const searchInput = document.getElementById('search');
    const filters = document.querySelectorAll('.filter');
    const salaryFilters = document.querySelectorAll('.filter-salary');
    const jobList = document.getElementById('jobList');
    const openPostForm = document.getElementById('openPostForm');
    const popup = document.getElementById('postJobPopup');
    const closePopup = document.getElementById('closePopup');
    const submitJob = document.getElementById('submitJob');
    const logoutBtn = document.getElementById('logoutBtn');

    function filterJobs() {
      const searchTerm = searchInput.value.toLowerCase();
      const jobCards = jobList.querySelectorAll('.job-card');

      const activeFilters = Array.from(filters)
        .filter(f => f.checked)
        .map(f => f.value);
      const activeSalary = Array.from(salaryFilters)
        .filter(f => f.checked)
        .map(f => f.value);

      jobCards.forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        const company = card.querySelector('.company').textContent.toLowerCase();
        const category = card.dataset.category;
        const type = card.dataset.type;
        const salary = card.dataset.salary;

        const matchesSearch = title.includes(searchTerm) || company.includes(searchTerm);
        const matchesFilter = activeFilters.length === 0 || activeFilters.includes(category) || activeFilters.includes(type);
        const matchesSalary = activeSalary.length === 0 || activeSalary.includes(salary);

        card.style.display = (matchesSearch && matchesFilter && matchesSalary) ? 'block' : 'none';
      });
    }

    searchInput.addEventListener('input', filterJobs);
    filters.forEach(f => f.addEventListener('change', filterJobs));
    salaryFilters.forEach(f => f.addEventListener('change', filterJobs));

    openPostForm.addEventListener('click', () => popup.classList.add('active'));
    closePopup.addEventListener('click', () => popup.classList.remove('active'));

    submitJob.addEventListener('click', () => {
      const title = document.getElementById('jobTitle').value.trim();
      const company = document.getElementById('companyName').value.trim();
      const location = document.getElementById('location').value.trim();
      const category = document.getElementById('category').value;
      const type = document.getElementById('jobType').value;
      const salary = document.getElementById('salary').value.trim();

      if (!title || !company || !location || !salary) {
        alert('Please fill in all fields.');
        return;
      }

      const salaryCategory = salary.includes('â‚±120') ? 'high' : (salary.includes('â‚±80') ? 'mid' : 'low');

      const card = document.createElement('div');
      card.classList.add('job-card');
      card.dataset.category = category;
      card.dataset.type = type;
      card.dataset.salary = salaryCategory;

      card.innerHTML = `
        <div class="job-header">
          <h3>${title}</h3>
          <span class="tag ${category}">${category.charAt(0).toUpperCase() + category.slice(1)}</span>
        </div>
        <div class="company">${company}</div>
        <div class="details">ğŸ“ ${location} Â· ${salary} Â· ${type.replace('-', ' ')}</div>
        <a href="#" class="view-btn">View Details</a>
      `;

      jobList.appendChild(card);
      popup.classList.remove('active');
      document.querySelectorAll('.popup-content input').forEach(i => i.value = '');
      filterJobs();
    });

    // Hide "Post a Job" button for Job Seekers
    window.addEventListener('load', () => {
      const accountType = sessionStorage.getItem('accountType'); // or get it from authStore.model.role
      if (accountType === 'Job Seeker') {
        openPostForm.style.display = 'none';
      }
    });

    // Logout button clears auth and redirects
    logoutBtn.addEventListener('click', () => {
      pb.authStore.clear();
      sessionStorage.clear();
      window.location.href = 'test.html';
    });
  </script>
</body>
</html>
