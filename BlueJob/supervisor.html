<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Site Supervisor - BlueJob</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <div class="left-header"><div class="logo">BlueJob</div></div>
  <div class="search-bar"><input type="text" placeholder="Search jobs, companies, or skills..."></div>
  <nav>
    <a href="jobs.html">Find Jobs</a>
    <a href="#">Companies</a>
    <a href="#">Resources</a>
    <button class="back-btn" id="backBtn">‚Üê Back</button>
  </nav>
</header>

<div class="job-page">
  <main>
    <div class="job-header">
      <h2>Site Supervisor</h2>
      <span class="tag supervisor">Supervisor</span>
      <div class="company">MetroWorks</div>
      <div class="details">üìç Taguig City ¬∑ ‚Ç±45,000‚Äì‚Ç±55,000/month ¬∑ Full-time</div>
      <div class="details">Posted 3 days ago</div>
    </div>

    <h3>Job Description</h3>
    <p>Oversee construction or technical teams, ensuring projects run efficiently, safely, and on schedule.</p>

    <h3>Responsibilities</h3>
    <ul>
      <li>Manage daily site operations and team assignments</li>
      <li>Ensure compliance with safety standards and regulations</li>
      <li>Coordinate between teams, contractors, and clients</li>
      <li>Monitor project timelines and quality control</li>
    </ul>

    <h3>Requirements</h3>
    <ul>
      <li>3+ years experience as a supervisor</li>
      <li>Strong leadership and problem-solving skills</li>
      <li>Knowledge of project management</li>
      <li>Ability to communicate effectively with teams and clients</li>
    </ul>

    <h3>Benefits & Perks</h3>
    <ul>
      <li>Monthly salary with bonuses</li>
      <li>Health coverage</li>
      <li>Company vehicle allowance</li>
      <li>Professional development opportunities</li>
    </ul>

    <a href="#" class="apply-btn" id="openFormBtn">Apply Now</a>
    <div class="confirmation" id="confirmationMsg" style="display:none;">Application Sent!</div>
  </main>

  <aside>
    <h2>About MetroWorks</h2>
    <p>MetroWorks specializes in construction and technical project management, providing high-quality services across Metro Manila.</p>

    <h2>Similar Jobs</h2>
    <ul>
      <li><strong>Construction Foreman</strong><br>BuildRight ‚Äî ‚Ç±50,000‚Äì‚Ç±60,000/month</li>
      <li><strong>Project Engineer</strong><br>BuildPro ‚Äî ‚Ç±50,000/month</li>
    </ul>
  </aside>
</div>

<!-- Popup Form -->
<div class="popup-overlay" id="popupForm" style="display:none;">
  <div class="popup-form">
    <span class="close-btn" id="closeForm">&times;</span>
    <h3>Apply for Site Supervisor</h3>
    <form id="jobApplicationForm" enctype="multipart/form-data">
      <input type="text" id="applicantName" placeholder="Name" required>
      <input type="email" id="applicantEmail" placeholder="Email" required>
      <input type="tel" id="applicantPhone" placeholder="Phone" required>

      <label for="fileUpload">Upload Photos or Files:</label>
      <input type="file" id="fileUpload" name="fileUpload" accept="image/*,.pdf,.doc,.docx" multiple required>

      <button type="submit">Submit Application</button>
    </form>
  </div>
</div>

<script src="https://unpkg.com/pocketbase@latest/dist/pocketbase.umd.js"></script>
<script>
  const backBtn = document.getElementById('backBtn');
  backBtn.addEventListener('click', () => {
    document.referrer ? history.back() : window.location.href = 'jobs.html';
  });

  const openFormBtn = document.getElementById('openFormBtn');
  const popupForm = document.getElementById('popupForm');
  const closeForm = document.getElementById('closeForm');
  const jobForm = document.getElementById('jobApplicationForm');
  const confirmationMsg = document.getElementById('confirmationMsg');

  openFormBtn.addEventListener('click', (e) => {
    e.preventDefault();
    popupForm.style.display = 'flex';
    confirmationMsg.style.display = 'none';
  });

  closeForm.addEventListener('click', () => {
    popupForm.style.display = 'none';
  });

  // Initialize PocketBase client
  const pb = new PocketBase('http://127.0.0.1:8090');

  const currentJobId = 'Site Supervisor';

  jobForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('applicantName').value.trim();
    const email = document.getElementById('applicantEmail').value.trim();
    const phone = document.getElementById('applicantPhone').value.trim();
    const filesInput = document.getElementById('fileUpload');

    if (!name || !email || !phone) {
      alert('Please fill in all required fields.');
      return;
    }
    if (filesInput.files.length === 0) {
      alert('Please upload at least one file.');
      return;
    }

    try {
      const formData = new FormData();
      formData.append('name', name);
      formData.append('email', email);
      formData.append('phone', phone);
      formData.append('job', currentJobId);

      const fileFieldName = 'file';

      for (const file of filesInput.files) {
        formData.append(fileFieldName, file, file.name);
      }

      const record = await pb.collection('applications').create(formData);

      console.log('Application saved:', record);

      popupForm.style.display = 'none';
      confirmationMsg.style.display = 'block';
      jobForm.reset();

    } catch (error) {
      console.error('Failed to submit application:', error);
      alert('Failed to submit application. Please try again later.');
    }
  });
</script>
</body>
</html>
